# خطة تحويل النظام من إدارة مخازن إلى نظام محاسبي مؤسساتي (ERP)

## 1. الرؤية العامة
الهدف هو بناء محرك محاسبي مركز يعتمد على مبدأ القيد المزدوج (Double-Entry Bookkeeping) ليكون هو "المصدر الوحيد للحقيقة" في النظام، حيث تترجم جميع حركات المخازن، المبيعات، والمشتريات إلى قيود محاسبية آليه.

## 2. الهيكل البرمجي الجديد
### تطبيق `accounting` (التطبيق المركزي)
- **Account (شجرة الحسابات):** هيكل هرمي يدعم الأصول، الخصوم، حقوق الملكية، الإيرادات، والمصروفات.
- **JournalEntry (رأس القيد):** يوثق العملية (التاريخ، الرقم المرجعي، الوصف).
- **JournalItem (سطور القيد):** المدين والدائن لكل حساب.

## 3. مراحل التنفيذ

### المرحلة الأولى: البنية التحتية (Infrastructure)
1. إنشاء تطبيق `accounting`.
2. إضافة `django-mptt` لإدارة شجرة الحسابات الهرمية.
3. تعريف موديلات الحسابات والقيود.
4. إنشاء شجرة حسابات افتراضية (Standard COA).

### المرحلة الثانية: الربط (Integration)
- [x] ربط جهات الاتصال (العملاء/الموردين) بحسابات في الأستاذ العام.
- [x] ربط الخزائن (Safes) بحسابات نقدية.
- [x] ربط المخازن بحسابات الأصول المخزنية.
- [x] ربط المنتجات بحسابات الإيرادات وتكلفة البضاعة.

### المرحلة الثالثة: المحرك التلقائي (Auto-Posting Engine)
- [x] تعديل منطق حفظ الفواتير لإنشاء قيود محاسبية بدلاً من تحديث الأرصدة يدوياً.
- [x] بناء منطق ضريبة القيمة المضافة (UAE VAT) داخل القيود.
- [x] إنشاء وظائف التحقق من توازن القيود قبل الحفظ.
- [x] أتمتة قيود المصروفات والإيرادات الأخرى.
- [x] أتمتة قيود الرواتب والسلف للموظفين.

### المرحلة الرابعة: التقارير المالية
- [x] ميزان المراجعة (Trial Balance).
- [x] قائمة الدخل (Profit & Loss).
- [x] الميزانية العمومية (Balance Sheet).
- [x] تقرير ضريبة القيمة المضافة (VAT Return Report).

### المرحلة الخامسة: الرقابة المالية المتقدمة (Advanced Control)
- [x] نظام قفل الفترات المالية (Financial Period Lock).
- [x] نظام مراكز التكلفة (Cost Centers).
- [x] سجل تدقيق الحركات (Audit Trail).
- [x] ربط حركات المخازن (Store Permits) بالنظام المحاسبي (Inventory vs COGS).
- [x] أتمتة ضريبة القيمة المضافة (UAE VAT) في القيود.
- [x] نظام إهلاك الأصول الثابتة (Fixed Assets).
- [x] تحسين التقارير المالية (تصدير Excel وطباعة).
- [x] أتمتة الرواتب والسلف.

## 4. القواعد المحاسبية للترحيل (Posting Rules)
| العملية | الحساب المدين (Debit) | الحساب الدائن (Credit) |
| :--- | :--- | :--- |
| فاتورة بيع آجلة | حساب العميل | حساب المبيعات + حساب الضريبة |
| فاتورة شراء آجلة | حساب المشتريات + حساب الضريبة | حساب المورد |
| تحصيل نقدي | حساب الخزينة | حساب العميل |
| دفع مصروف | حساب المصروف + حساب الضريبة | حساب الخزينة |
